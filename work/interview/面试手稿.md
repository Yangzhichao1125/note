# 面试手稿



## 自我介绍

```
你好，我叫杨志超，17年毕业于福建福州的闽江学院，大三的时候开始学的Java，当时在学校里和几个同学做了医疗保障平台的系统，毕业后做了一个汽车保险的项目，用的是SSM框架加MySql，后来去了宁德时代实习，宁德时代是在18年的时候在创业板上市，上市后市值是上千亿的这么一个规模，我在那做了一个工厂的安灯系统项目。还有就是近阶段做的一个贝仓app商城项目，该项目属于贝贝集团旗下的一个产品，目前用户量有一千万左右，日活跃用户在100万左右。
```



## 项目架构介绍

```

```



## 为什么用Spring Cloud

```
目前市场上的分布式服务技术栈主要是Spring Cloud 和 Dubbo 两个，而且Spring Cloud 和Dubbo 以及阿里的一些技术正在融合，叫Spring Cloud Albaba，不过目前用的公司并不多。我们公司是比较循规蹈矩的，所以在Spirng Cloud，以及Dubbo中选择一个。那这就要对比两个技术栈的一个优缺点了。

首先是网络带宽这个一块，Dubbo是用二进制的传输，带宽占用较少。Spring Cloud 是用http协议传输，通常情况下还是用json形式的报文模式，所以占用的带宽比较高。但对于目前的互联网公司来说这个网络消耗并不算太大的问题，如果真又问题，也可以通过压缩，二进制，高速缓存，分段降级等方法解决。
另一个方面从开发难度这一块，Dubbo开发难度会比较大，主要原因就是jar包依赖升级的问题。非常麻烦。Spring Cloud比较自由，但是接口的规范没有一个强力的约束，所以需要一个强力的行政约束，做一个统一的接口规范。所以这个也很好解决
在注册中心这块Dubbo可以用zookeeper，redis等多种技术，Spring Cloud只能用Eureka或者自研。
```

## 主要负责哪些功能

```
我主要负责订单微服务
首先就是生成ID的方式我们采用雪花算法
分库分表
注册中心，网关zuul，动态路由，灰度发布
分布式事务
```



## spring boot 自动配置原理

```
首先什么是自动配置，就是在pom.xml里面引入对应的starter 比如说 Redis-starter 然后在application.yml中配置对应的参数就能直接使用jedis。
springboot自动装配的原理实际就是通过springFactoryClassLoader将META-INF/spring.factory的信息读取出来，将所需的bean放入到Ioc容器中。
springBoot的注解@SpringBottApplicatoin =》  EnableAutoConfigration =》 EnableAutoCOnfigrationImportSelector => META-INF/spring.factory 配置将所需的bean注入到Ioc容器中。
```

## Hystrix资源隔离的方式有哪些

```
雪崩效应
线程池（默认）和信号量
```















```
为什么用分布式

注册中心，feign，ribbon

zuul，动态路由，灰度发布，统一限流，统一熔断

为什么用spring cloud

Dubbo 系统架构 （service，config，proxy，regist，clustor，monitor，protocol，exchange，transport，serilize）

Dubbo网络通讯原理 （netty，NIO，Acceptor，selector，ServerSocketChanel，端口，SocketChanel，selector，processor，解析请求）

Dubbo怎么实现扩展

如何设计RPC框架（动态代理，注册中心，负载均衡，协议，request，序列化，netty）

Eureka（服务注册表，ReadWrite，ReadOnly）

Spring Cloud 和 Dubbo 的对比

Eureka，ZooKeeper集群服务注册原理

优化服务发现过慢 （Eureka 3个 ，客户端2个 ，关闭自我保护）

注册中心 注册，故障发现时效性多长，配置如何，几台机器，最大支持多少服务实例（两台4核8g ，一千+的服务都不成问题）

网关的技术选型（动态路由，灰度发布，授权认证，流量监控，统一限流降级）

如何实现动态路由（数据库）

网关10万并发的的优化（8核16G 1000+）

上万服务实例，现有注册中心能否抗住（分片）

灰度发布方案（配置新版本，数据库开启对应服务的灰度发布，代码负载均衡）

一个服务开发，上线，服务注册，网关路由，服务调用过程

整个系统配置
网关（4核8G，4台，1000+）
注册中心（4核8G，2台，每秒发送一次心跳）
服务（4核8G，2台，1000+）
数据库（16核32G，3000-4000并发没什么问题）

每天多大访问量，每个服务高峰QPS是多少

访问量增加10倍，如何扩容

如何配置超时和重试（ribbon 组件饥饿加载）

服务请求重试，会重复下单？

核心接口的幂等方案（mysql ，redis + springMVC）

核心交易链路,如何设计分布式方案

seata核心架构原理（TM， RM ，TC ,XID）

TCC方案性能瓶颈，如何优化

RocketMQ分布式事务（half，success，核心链路，链路响应，失败退款改状态回滚消息，成功提交消息，消费，ack）

哪些场景需要用到分布式锁

Redisson 框架原理（1设置key value 过期时间，看门狗，生存时间，另外线程不断循环。删除key，宕机过期时间）

集群故障redis锁会失效

curator原理

Zookeeper的羊群效应

脑裂问题保证分布式锁健壮性

分布式锁高并发优化（分段加锁 + 合并扣减）

京东淘宝库存实现（redis + MQ + database）


微服务，分布式事务，分布式锁，幂等，分库分表

订单模块流程

```

